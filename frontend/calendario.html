<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario (Prueba Mínima)</title>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.11/index.global.min.js'></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #calendario { border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Prueba de Calendario de Recursos</h1>
    <div id="calendario" style="height: 80vh;"></div>

<script type="module">
    import { checkSession, fetchAPI } from './api.js';

    document.addEventListener('DOMContentLoaded', async () => {
        const calendarEl = document.getElementById('calendario');
        
        // Verificar sesión primero
        const session = checkSession();
        if (!session) {
            calendarEl.innerHTML = '<p style="color:red;">Error: Sesión no válida.</p>';
            return;
        }

        try {
            // 1. Obtener los "recursos" (las cabañas)
            const cabanas = await fetchAPI('/api/cabanas');
            const resources = cabanas.map(c => ({ id: c.nombre, title: c.nombre }));

            // 2. Obtener los "eventos" (las reservas) para el mes actual
            const today = new Date();
            const anio = today.getFullYear();
            const mes = today.getMonth() + 1;
            const events = await fetchAPI(`/api/reservas/calendario?anio=${anio}&mes=${mes}`);

            // 3. Inicializar el calendario con la configuración mínima necesaria
            const calendar = new FullCalendar.Calendar(calendarEl, {
                schedulerLicenseKey: 'GPL-My-Project-Is-Open-Source',
                initialView: 'resourceTimelineMonth',
                locale: 'es',
                timeZone: 'UTC',
                headerToolbar: { // Barra de herramientas básica para navegar
                    left: 'prev,next today',
                    center: 'title',
                    right: ''
                },
                resources: resources,
                events: events
            });

            // 4. Renderizar el calendario
            calendar.render();

        } catch (error) {
            calendarEl.innerHTML = `<p style="color:red; font-weight:bold;">Error al inicializar el calendario: ${error.message}</p>`;
            console.error(error);
        }
    });
</script>
</body>
</html>