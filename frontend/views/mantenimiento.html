<div class="bg-white p-8 rounded-lg shadow">
    <h2 class="text-2xl font-semibold text-gray-900 mb-4">Herramientas de Mantenimiento</h2>
    <div class="space-y-4">
        <div>
            <p class="text-gray-600 mb-2">Si las reservas antiguas no aparecen en "Gestión Diaria", usa este botón una vez para reparar los datos.</p>
            <button id="repair-btn" class="w-full sm:w-auto inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-gray-700 hover:bg-gray-800">
                Reparar Estados de Reservas
            </button>
            <div id="repair-status" class="mt-4 p-4 rounded-md hidden"></div>
        </div>
        <div class="border-t pt-4 mt-4">
            <p class="text-gray-600 mb-2">Si las reservas de Booking aparecen sin teléfono en "Gestión Diaria", usa este botón una vez para repararlas.</p>
            <button id="repair-phones-btn" class="w-full sm:w-auto inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-gray-700 hover:bg-gray-800">
                Reparar Teléfonos Faltantes
            </button>
            <div id="repair-phones-status" class="mt-4 p-4 rounded-md hidden"></div>
        </div>
    </div>
</div>

<script type="module">
    import { fetchAPI } from '../api.js';

    const repairBtn = document.getElementById('repair-btn');
    const repairStatus = document.getElementById('repair-status');
    const repairPhonesBtn = document.getElementById('repair-phones-btn');
    const repairPhonesStatus = document.getElementById('repair-phones-status');

    repairBtn.addEventListener('click', async () => {
        if (!confirm('Esta acción revisará todas las reservas y reparará las que no tengan un estado de gestión. ¿Deseas continuar?')) { return; }
        repairBtn.disabled = true;
        repairBtn.textContent = 'Reparando...';
        repairStatus.classList.remove('hidden');
        repairStatus.textContent = 'Iniciando proceso...';
        try {
            const result = await fetchAPI('/api/gestion/fix-missing-states', { method: 'POST' });
            repairStatus.innerHTML = `<strong>Éxito:</strong> ${result.message}`;
        } catch (error) {
            repairStatus.innerHTML = `<strong>Error:</strong> ${error.message}`;
        } finally {
            repairBtn.disabled = false;
            repairBtn.textContent = 'Reparar Estados de Reservas Antiguas';
        }
    });

    repairPhonesBtn.addEventListener('click', async () => {
        if (!confirm('Esta acción revisará todas las reservas y reparará las que no tengan un número de teléfono. ¿Deseas continuar?')) { return; }
        repairPhonesBtn.disabled = true;
        repairPhonesBtn.textContent = 'Reparando...';
        repairPhonesStatus.classList.remove('hidden');
        repairPhonesStatus.textContent = 'Iniciando reparación...';
        try {
            const result = await fetchAPI('/api/gestion/fix-missing-phones', { method: 'POST' });
            repairPhonesStatus.innerHTML = `<strong>Éxito:</strong> ${result.message}`;
        } catch (error) {
            repairPhonesStatus.innerHTML = `<strong>Error:</strong> ${error.message}`;
        } finally {
            repairPhonesBtn.disabled = false;
            repairPhonesBtn.textContent = 'Reparar Teléfonos Faltantes';
        }
    });
</script>